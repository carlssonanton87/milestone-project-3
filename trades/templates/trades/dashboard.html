{% extends 'trades/base.html' %}
{% block content %}

<h2 class="mb-4">Trading Dashboard</h2>

<form method="get" class="mb-4">
  <div class="row g-2 align-items-end">
    <div class="col-auto">
      <label for="daterange" class="form-label">Select Date Range</label>
      <input type="text" id="daterange" name="daterange" class="form-control"
       value="{{ request.GET.daterange|default:'' }}" autocomplete="off" />


    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-outline-dark">Apply</button>
    </div>
  </div>
</form>

<script>
$(function() {
  function applyRange(start, end) {
    $('#daterange').val(start.format('YYYY-MM-DD') + ' - ' + end.format('YYYY-MM-DD'));
  }

  $('#daterange').daterangepicker({
    startDate: moment().subtract(6, 'days'),
    endDate: moment(),
    ranges: {
       'Today': [moment(), moment()],
       'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
       'Last 7 Days': [moment().subtract(6, 'days'), moment()],
       'Last 30 Days': [moment().subtract(29, 'days'), moment()],
       'This Month': [moment().startOf('month'), moment().endOf('month')],
       'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
    },
    locale: {
      format: 'YYYY-MM-DD',
      cancelLabel: 'Clear'
    }
  }, applyRange);

  // Fill input initially if value already exists
  let existing = $('#daterange').val();
  if (!existing) {
    applyRange(moment().subtract(6, 'days'), moment());
  }

  // Clear on cancel
  $('#daterange').on('cancel.daterangepicker', function(ev, picker) {
    $(this).val('');
  });
});
</script>





<div class="row text-center">
  <div class="col-md-4 mb-4">
    <div class="card bg-primary text-white">
      <div class="card-body">
        <h5>Total Trades</h5>
        <p class="fs-4">{{ total_trades }}</p>
      </div>
    </div>
  </div>

  <div class="col-md-4 mb-4">
    <div class="card bg-success text-white">
      <div class="card-body">
        <h5>Win Rate</h5>
        <p class="fs-4">{{ win_rate }}%</p>
      </div>
    </div>
  </div>

  <div class="col-md-4 mb-4">
    <div class="card bg-warning text-dark">
      <div class="card-body">
        <h5>Average Return</h5>
        <p class="fs-4">{{ avg_return }}%</p>
      </div>
    </div>
  </div>

  <div class="col-md-6 mb-4">
    <div class="card bg-info text-dark">
      <div class="card-body">
        <h5>Average Holding Time</h5>
        <p class="fs-4">{{ avg_holding }} days</p>
      </div>
    </div>
  </div>

  <div class="col-md-6 mb-4">
    <div class="card bg-dark text-white">
      <div class="card-body">
        <h5>Open vs Closed</h5>
        <p class="fs-4">{{ open_trades }} open / {{ closed_trades }} closed</p>
      </div>
    </div>
  </div>
</div>

{% endblock %}
